<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>أهلاً سيد عباس الميكانيكي</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
    font-family: Arial;
    background:#f4f4f4;
    direction: rtl;
}

.login,.container{
    max-width:1100px;
    margin:60px auto;
    background:#fff;
    padding:25px;
    border-radius:8px;
    box-shadow:0 0 10px rgba(0,0,0,.1);
}

h2{text-align:center;margin-bottom:20px}

input{
    width:100%;
    padding:12px;
    margin-bottom:15px;
}

button{
    padding:6px 10px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    color:#fff;
}

.login button{background:#007bff;width:100%}

table{
    width:100%;
    border-collapse:collapse;
}

th,td{
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}

th{background:#007bff;color:#fff}

.call{background:#28a745}
.accept{background:#17a2b8}
.reject{background:#dc3545}
.delete{background:#000}

.hidden{display:none}
</style>
</head>

<body>

<div class="login" id="loginBox">
    <h2>تسجيل الدخول</h2>
    <input type="password" id="password" placeholder="كلمة السر">
    <button onclick="login()">دخول</button>
</div>

<div class="container hidden" id="app">
    <h2>أهلاً سيد عباس الميكانيكي – هاهم طلباتك</h2>

    <table>
        <thead>
            <tr>
                <th>الاسم</th>
                <th>الهاتف</th>
                <th>السيارة</th>
                <th>المشكلة</th>
                <th>التاريخ</th>
                <th>الوقت</th>
                <th>ملاحظات</th>
                <th>الحالة</th>
                <th>إجراءات</th>
            </tr>
        </thead>
        <tbody id="data"></tbody>
    </table>
</div>

<script>
/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyCLCSPOV1nuk5RvQiSJcjc18rxXbC0Ei9Y",
  authDomain: "bot-djasser-achlaf-4494.firebaseapp.com",
  databaseURL: "https://bot-djasser-achlaf-4494-default-rtdb.firebaseio.com",
  projectId: "bot-djasser-achlaf-4494",
  storageBucket: "bot-djasser-achlaf-4494.firebasestorage.app",
  messagingSenderId: "500557963512",
  appId: "1:500557963512:web:a32bf5c21ba508662b5b0d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* Login */
function login(){
    if(document.getElementById("password").value === "ABBAS VW1977"){
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        loadAppointments();
    }else{
        alert("كلمة السر غير صحيحة");
    }
}

/* Load Appointments */
function loadAppointments(){
    const ref = db.ref("appointments");
    ref.on("value", snapshot=>{
        const tbody = document.getElementById("data");
        tbody.innerHTML = "";

        snapshot.forEach(child=>{
            const d = child.val();
            const id = child.key;

            tbody.innerHTML += `
            <tr>
                <td>${d.name || ""}</td>
                <td>${d.phone || ""}</td>
                <td>${d.car || ""}</td>
                <td>${d.issue || ""}</td>
                <td>${d.date || ""}</td>
                <td>${d.time || ""}</td>
                <td>${d.notes || ""}</td>
                <td>${d.status || "pending"}</td>
                <td>
                    <button class="call" onclick="call('${d.phone}')">اتصال</button>
                    <button class="accept" onclick="accept('${id}')">قبول</button>
                    <button class="reject" onclick="remove('${id}')">رفض</button>
                    <button class="delete" onclick="remove('${id}')">حذف</button>
                </td>
            </tr>`;
        });
    });
}

/* Actions */
function call(phone){
    window.location.href = "tel:" + phone;
}

function accept(id){
    db.ref("appointments/"+id).update({status:"accepted"});
}

function remove(id){
    if(confirm("هل أنت متأكد؟")){
        db.ref("appointments/"+id).remove();
    }
}
</script>

</body>
</html>
